<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="/index.xml" rel="alternate" type="application/rss+xml" title="Bhaskar Karambelkar&#39;s Blog" />
<link href="/index.xml" rel="feed" type="application/rss+xml" title="Bhaskar Karambelkar&#39;s Blog" />

  <title>
    
    
       Re-plotting Russian AirStrikes In Syria 
    
  </title>
  <link rel="canonical" href="/2015/11/re-plotting-russian-airstrikes-in-syria/">
  


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" integrity="sha256-t2/7smZfgrST4FS1DT0bs/KotCM74XlcqZN5Vu7xlrw=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton-framework/1.1.1/skeleton.min.css"
    integrity="sha256-nXC6R0O+3ez3B440sqRACd9wvr4A1cHmzr1K+2bINzk=" crossorigin="anonymous" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.9.0/css/lightbox.min.css" integrity="sha256-iU/Wh1HMAs/NgpurDAu14e7S3FkllcJ5aPnpPDdnO6c=" crossorigin="anonymous" />



<link rel="stylesheet" type="text/css" href="/css/styles.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/androidstudio.min.css" integrity="sha256-rEVnyeMfkKzmBwocdeeiqGOu1M/ttUHB7K0meKIwqvw=" crossorigin="anonymous" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/balloon-css/0.4.0/balloon.min.css" />


<link rel="shortcut icon"

    href="/img/favicon.ico"
>



</head>

<a data-balloon="Back to Top" data-balloon-pos="left" id="back-to-top"><i class="fa fa-arrow-circle-up fa-3x" aria-hidden="true"></i></a>

<body lang="en-US">
    <script>
        document.body.className += ' fade-out';
    </script>
    <div class="container">
        <section class="header row">
            <div class="columns twelve">
                <h1>
                    <div class="name">Bhaskar Karambelkar&#39;s Blog</div>
                </h1>
                <nav>
                    <ul>
                        
                        <li><a class="button" href="/"><i class='fa fa-home fa-2x'></i><span class="text">&nbsp;Home</span></a></li>
                        
                        <li><a class="button" href="/tags/"><i class='fa fa-tags fa-2x'></i><span class="text">&nbsp;Tags</span></a></li>
                        
                        <li><a class="button" href="/series/"><i class='fa fa-folder-open fa-2x'></i><span class="text">&nbsp;Series</span></a></li>
                        
                        <li><a class="button" href="/about/"><i class='fa fa-info-circle fa-2x'></i><span class="text">&nbsp;About</span></a></li>
                        
                        <li><a class="button" href="http://photos.karambelkar.info"><i class='fa fa-camera-retro fa-2x'></i><span class="text">&nbsp;Photography</span></a></li>
                        
                    </ul>
                </nav>
            </div>
        </section>

</section>
<section class="row content">
    <div class="columns twelve">
        <div class="title-container">
            <h1 class="page-heading">
    
        Re-plotting Russian AirStrikes In Syria
    
</h1>

            <p class="meta">&nbsp;<i class="fa fa-calendar-o"></i> Tue Nov 10 2015 11:56:30 EST</p>
            <p id="tags"><small>Tags: </small>
                
                    <a class="tag-button" href="//tags/r-stats">R-stats</a>
                
                    <a class="tag-button" href="//tags/dataviz">DataViz</a>
                
                    <a class="tag-button" href="//tags/cartography">Cartography</a>
                
                    <a class="tag-button" href="//tags/leaflet">Leaflet</a>
                
            </p>
            <hr/>
        </div>
        
        <div id="toc" class="table-of-contents">
            <strong>Table of Contents</strong>
            <hr class="top"/>
            <nav id="TableOfContents">
<ul>
<li><a href="#tl-dr">TL;DR</a></li>
<li><a href="#long-read">Long Read</a>
<ul>
<li><a href="#data-acquisition">Data Acquisition</a></li>
<li><a href="#data-preparation">Data Preparation</a></li>
<li><a href="#data-plotting">Data Plotting</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav>
            <hr class="bottom"/>
        </div>
        
        <div class="page-content">
            <p>My Cartography mentor <a href="https://twitter.com/hrbrmstr" target="_blank">Bob Rudis</a> pointed me to a blog post visualizing <a href="http://r-datameister.blogspot.com/2015/11/plotting-russian-airstrikes-in-syria.html" target="_blank">Russian Air Strikes in Syria</a> and commanded me to redo the static maps to something more interactive and easier to explore.
</p>

<h1 id="tl-dr">TL;DR</h1>

<p>Interactive Map at <a href="http://rpubs.com/bhaskarvk/russian-airstrikes-in-syria" target="_blank">Rpubs</a> created using Leaflet after scraping data using RSelenium+ PhantomJS + dplyr. You can use the LayerSelector at the Top Right to toggle various Base Tiles. Clicking on any Marker will show details about that Air Strike.</p>

<h1 id="long-read">Long Read</h1>

<h2 id="data-acquisition">Data Acquisition</h2>

<p>The data comes from crowdsourcing of Russian Ministry of Defense&rsquo;s (MOD) Youtube<sup>TM</sup> channel. The process and the data is described <a href="https://www.bellingcat.com/news/mena/2015/10/26/what-russias-own-videos-and-maps-reveal-about-who-they-are-bombing-in-syria/" target="_blank">here</a> and the data can be found at <a href="http://russia-strikes-syria.silk.co/" target="_blank">http://russia-strikes-syria.silk.co/</a>. The argument is that a majority of the strikes claimed by the Russian MOD to be targeting ISIS held areas are actually targeting non-ISIS rebel areas and as such helping the Asaad regime more than fighting ISIS.</p>

<p>The original visualization was done by copying the data and putting it in an excel spreadsheet and then mapped using R&rsquo;s <code>ggmap</code> package. But in the interest of reproducibility I wanted to scrape the data directly from within R. For this I initially tried using <a href="https://cran.r-project.org/web/packages/rvest/" target="_blank">rvest</a> but quickly realized that this was a no go as the table containing the data was dynamically populated using AJAX/Javascript stuff. So I had to turn to RSelenium + PhantomJS as described <a href="https://cran.r-project.org/web/packages/RSelenium/vignettes/RSelenium-headless.html" target="_blank">here</a>.</p>

<p>Below is the web-scraping code, and the webpage from where this data was scraped can be found <a href="http://russia-strikes-syria.silk.co/explore/table/collection/strike-id/column/date-uploaded/column/time-in-utc-uploaded/column/accuracy-of-russian-location/column/actual-location-co-ords/column/closest-location-governorate/column/claimed-location/column/claimed-targets/column/closest-location-actual/column/status/column/isis-in-the-area/column/error-type/column/notes/column/checkdesk-link/column/video-url/slice/0/1000" target="_blank">here</a>.</p>

<pre><code class="language-r">library(RSelenium)
library(rvest)

pJS &lt;- phantom()
Sys.sleep(5) # give the binary a moment
remDr &lt;- remoteDriver(browserName = 'phantomjs')
remDr$open()
remDr$navigate('http://russia-strikes-syria.silk.co/explore/table/collection/strike-id/column/date-uploaded/column/time-in-utc-uploaded/column/accuracy-of-russian-location/column/actual-location-co-ords/column/closest-location-governorate/column/claimed-location/column/claimed-targets/column/closest-location-actual/column/status/column/isis-in-the-area/column/error-type/column/notes/column/checkdesk-link/column/video-url/slice/0/1000')
Sys.sleep(2) # Some time for page to load
events &lt;- read_html(remDr$getPageSource()[[1]]) %&gt;%
  html_node(xpath= '//*[@id=&quot;canvas&quot;]/div/div[3]/div[2]/div[2]/div[4]/table') %&gt;%
  html_table()
remDr$close()
pJS$stop() # close the PhantomJS process

</code></pre>

<p><br/>
In short the code starts a RSelenium + PhantomJS WebDriver fetches the webpage containing the data. Then the html table is parsed using rvest&rsquo;s <code>html_table()</code> after the correct table is selected using the proper xpath to the table.</p>

<h2 id="data-preparation">Data Preparation</h2>

<p>To plot the data correctly I need to perform the following steps.</p>

<ul>
<li>Filter out data containing invalid Lat/Long coordinates.</li>
<li>Split the single column containing Lat/Long in to two columns.</li>
<li>Create a new column to be used for Popup Display when a point is clicked on the map.</li>
</ul>

<p>Thankfully <code>dplyr</code> and <code>tidyr</code> are more than capable of doing all this using some basic simple steps shown below.</p>

<pre><code class="language-r">library(dplyr)
library(tidyr)

events %&gt;% filter(str_detect(`Actual location co-ords`,
                             '[0-9]+\\.[0-9]+, *[0-9]+\\.[0-9]+')) %&gt;%
  separate(`Actual location co-ords`,c('lat','lon'),
           sep = ',', convert = TRUE, remove = TRUE ) %&gt;%
  mutate(popup = sprintf('
    &lt;P&gt;&lt;center&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/center&gt;&lt;br/&gt;&lt;i&gt;Status:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Date Uploaded:&lt;/i&gt; &lt;b&gt;%s %s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Claimed Location:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Claimed Targets:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Closest Governorate:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Closest Actual Location:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;ISIS Presence:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Error:&lt;/i&gt; &lt;b&gt;%s&lt;/b&gt;&lt;br/&gt;&lt;i&gt;Notes:&lt;/i&gt; %s&lt;br/&gt;&lt;i&gt;Description:&lt;/i&gt; &lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt; / &lt;i&gt;Video:&lt;/i&gt; &lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;br/&gt;&lt;/P&gt;',
    Airstrikes, Status,
    `Date (Uploaded)`, `Time in UTC (Uploaded)`,
    `Claimed location`, `Claimed targets`,
    `Closest location governorate`, `Closest location (actual)`,
    `ISIS in the area?`, `Error type`,
    Notes, `Checkdesk link`, Airstrikes,
    `Video URL`, Airstrikes
    )) -&gt; events
</code></pre>

<p>The <code>filter</code> function filters out all data points which don&rsquo;t match the regex for the the Lat/Long format. The <code>separate</code> function splits the &lsquo;Actual location co-ords&rsquo; column in to two columns lat and lon. And finally the <code>mutate</code> function is used to create the HTML code that will be used to display the popup when this datapoint is clicked on the Map.</p>

<h2 id="data-plotting">Data Plotting</h2>

<p>Finally for Data Plotting I used <a href="https://rstudio.github.io/leaflet/" target="_blank">Leaflet for R</a> library. You will need to build the library from source as I use some new features in the library that haven&rsquo;t yet made it to CRAN. You can do this using <code>devetool::install_github('rstudio/leaflet')</code>.</p>

<p>The Map consists of following elements</p>

<ul>
<li>Multiple Base Tile Maps out of which only one can be active at any given time.</li>
<li>A GeoJSON for plotting the various Administrative areas of Syria superimposed on the base map.</li>
<li>Markers for the Air Strikes.</li>
<li>A Layer Selection option.</li>
<li>A mini map to know the global context.</li>
</ul>

<p>I also needed a way to visually distinguish between VERIFIED and FALSE strikes. Verified being strikes that claimed to have targeted ISIS and actually targeted ISIS or actually have targeted non-ISIS areas and not claimed to have targeted ISIS in short those where the claim and actual targets tally, and FALSE being the ones where there was a discrepancy in either the claimed and actual target or claimed and actual location. I chose to use Blue colored Markers for VERIFIED and Red colored for FALSE.</p>

<p>The code for plotting is shown below</p>

<pre><code class="language-r">library(leaflet)

if(!file.exists('./cities.json') {
	# Syrian Cities GeoJSON downloaded from
	# http://crisis.net/projects/syria-tracker/cities.json
	# More Info @ http://blog.crisis.net/choropleth-maps-with-d3/
	download.file(url='http://crisis.net/projects/syria-tracker/cities.json', destfile='cities.json')
}
cities &lt;- readLines('./cities.json', warn =F) %&gt;% paste(collapse='\n')

# Leaflet Map + Various Base Tiles
events %&gt;% leaflet() %&gt;%
  addTiles(group=&quot;Default&quot;) %&gt;%
  addProviderTiles('CartoDB.PositronNoLabels',group='Blank-Canvas') %&gt;%
  addProviderTiles('OpenStreetMap.BlackAndWhite', group=&quot;OSM-BlackNWhite&quot;) %&gt;%
  addProviderTiles('MapQuestOpen.OSM', group='MapQuest') %&gt;%
  addProviderTiles('Stamen.TonerLite', group='Stamen-Light') %&gt;%
  addProviderTiles('Esri.WorldStreetMap',group='Esri-1') %&gt;%
  addProviderTiles('Esri.DeLorme',group='Esri-2') %&gt;%
  addProviderTiles('Esri.OceanBasemap',group='Esri-3') %&gt;%
  addProviderTiles('Esri.NatGeoWorldMap',group='NatGeo') %&gt;%
  addProviderTiles('CartoDB.Positron',group='CartoDB-1') %&gt;%
  addProviderTiles('CartoDB.PositronNoLabels',group='CartoDB-2') %&gt;%
  addProviderTiles('Stamen.TonerHybrid',group='CartoDB-2') %&gt;%
  addProviderTiles('Stamen.TonerLines',group='CartoDB-2') %&gt;%
  addProviderTiles('CartoDB.DarkMatter',group='CartoDB-3') %&gt;%
  addProviderTiles('CartoDB.DarkMatterNoLabels',group='CartoDB-4') %&gt;%
  addProviderTiles('Acetate.basemap',group='Acetate') %&gt;%
  addProviderTiles('Stamen.TonerLabels',group='Acetate') -&gt; eventMap

# Awesome Icons with color depending on Status
icon &lt;- awesomeIcons(icon = 'crosshairs',
                     markerColor = ifelse(events$Status == 'VERIFIED','blue','red'),
                     library = 'fa',
                     iconColor = 'black')

# Add Markers for AirStrikes and GeoJSON for Syrian Regions
eventMap %&gt;%
  addAwesomeMarkers(
    lat=~lat, lng=~lon,
    label = ~Airstrikes, icon=icon,
    group = 'Air Strikes',
    popup = ~popup
  ) %&gt;%
  addGeoJSON(cities, weight = 0.7, color = &quot;#00FF00&quot;,
             stroke=T, fill = F, fillOpacity = 0.1,
             group='Syria Regions') -&gt; eventMap

# Add a Layer Control for toggling Layers/BaseMaps
eventMap  %&gt;%  addLayersControl(
  baseGroups = c('Default',
                 'Blank-Canvas',
                 'OSM-BlackNWhite',
                 'MapQuest',
                 'Stamen-Light',
                 'Esri-1',
                 'Esri-2',
                 'Esri-3',
                 'NatGeo',
                 'CartoDB-1',
                 'CartoDB-2',
                 'CartoDB-3',
                 'CartoDB-4',
                 'Acetate'),
  overlayGroups = c(&quot;Air Strikes&quot;, &quot;Syria Regions&quot;),
  options = layersControlOptions(collapsed = TRUE)
) -&gt; eventMap

# Finally Add a Minimap and render the Map
eventMap %&gt;% addMiniMap()

</code></pre>

<p><br/>
And the final map is shown below.</p>

<iframe class="b-lazy"  data-src="https://rstudio-pubs-static.s3.amazonaws.com/124776_4236f220adb94d12b4eecc77575e9076.html" 
  width="90%" 
  height="350px" >
 <p>Your browser does not support iframes.</p>
</iframe>

<p>Or access it at <a href="http://rpubs.com/bhaskarvk/russian-airstrikes-in-syria" target="_blank">Rpubs</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<ul>
<li>For Web Scraping dynamic data RSelinium + PhantomJS makes a killer combo.</li>
<li>R&rsquo;s leaflet library allows for easy creation of interactive maps.</li>
</ul>
        </div>
    </div>
</section>

<div class="row pager">
    <div class="twelve columns">
        
        <a data-balloon="Previous Post" data-balloon-pos="right" class="button button-primary" href="/2016/03/alternative-to-using-legends-in-ggplot2/">
            <i class="fa fa-angle-double-left fa-2x" aria-hidden="true"></i>
            <span class="text">Alternative to using legends in ggplot2</span>
        </a>
        &nbsp;
        
        <a data-balloon="Next Post" data-balloon-pos="left" class="u-pull-right button button-primary" href="/2015/10/shiny-in-a-smartos-zone/">
          <span class="text">Shiny in a SmartOS zone</span>
          <i class="fa fa-angle-double-right fa-2x" aria-hidden="true"></i>
      </a> 
    </div>
</div>

<section class="icons row content">
    <div class="columns twelve">

        
        <a target="_blank" data-balloon="LinkedIN" data-balloon-pos="up" title="LinkedIn" href="https://www.linkedin.com/in/bhaskarvk">
            <i class="fa fa-linkedin fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Twitter" data-balloon-pos="up" title="Twitter" href="https://www.twitter.com/bhaskar_vk">
            <i class="fa fa-twitter fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Github" data-balloon-pos="up" title="Github" href="https://github.com/bhaskarvk">
            <i class="fa fa-github-square fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Stack Overflow" data-balloon-pos="up" title="StackOverflow" href="https://stackoverflow.com/users/507484">
            <i class="fa fa-stack-overflow fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Keybase" data-balloon-pos="up" title="Keybase" href="https://www.keybase.io/bhaskarvk">
            <i class="fa fa-key fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Slideshare" data-balloon-pos="up" title="SlideShare" href="https://www.slideshare.net/bhaskar_vk">
            <i class="fa fa-slideshare fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Reddit" data-balloon-pos="up" title="Reddit" href="https://www.reddit.com/user/bhaskarvk">
            <i class="fa fa-reddit-alien fa-2x"></i>
        </a>
        
        
        <a target="_blank" data-balloon="Medium" data-balloon-pos="up" title="Medium" href="https://medium.com/@bhaskar_vk">
            <i class="fa fa-medium fa-2x"></i>
        </a>
        
        <a class="u-pull-right" data-balloon="HOME" data-balloon-pos="up" title="Home " href="/">
            <i class="fa fa-home fa-2x"></i>
        </a>
        <a class="u-pull-right" target="_blank" data-balloon="RSS Feed" data-balloon-pos="up" title="RSS Feed" href="/index.xml">
            <i class="fa fa-rss fa-2x"></i>&nbsp;</a>
    </div>
</section>

<section class="copyright row">
    <div class="columns twelve">
        Â© 2007-2017 Bhaskar V. Karambelkar. All rights reserved.
    </div>
</section>

</div>




<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
<script src="/js/back-to-top.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/blazy/1.8.2/blazy.min.js"
  integrity="sha256-D0J9D4igaYyVX/Y78Tr0yoDJsy8hi14hCEdFDakBp08=" crossorigin="anonymous"></script>
<script>
  ;(function () {
    var bLazy = new Blazy();
  })();
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.9.0/js/lightbox.min.js"
  integrity="sha256-9r7DHolfe5aoH+bUj4FEqRBq2tmaIXBxOYUZFalCjSE=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"
  integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/r.min.js"
  integrity="sha256-XrZQp+ZMfovqr6Hb2M6okHvSEYaB/+Xbx7toWmOOZUM=" crossorigin="anonymous"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.www.karambelkar.info","*.blog.karambelkar.info"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
  var u="//apps.karambelkar.info/pk/";
  _paq.push(['setTrackerUrl', u+'piwik.php']);
  _paq.push(['setSiteId', 1]);
  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
  g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//apps.karambelkar.info/pk/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>




</body>

</html>
