<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Leaflet Diary: Chapter 1, Plugins Galore</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="generator" content="Hugo 0.16" />
		<link href="" rel="alternate" type="application/rss+xml" title="Bhaskar Karambelkar&#39;s Blog" />
		<link href="" rel="feed" type="application/rss+xml" title="Bhaskar Karambelkar&#39;s Blog" />
		<link href="/css/bootstrap-solarized-light.css" rel="stylesheet">
		<link href="/css/hc-new.css" type="text/css"  rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"/>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/solarized_dark.min.css" rel="stylesheet"/>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.1/css/lightbox.min.css" rel="stylesheet"/>
    
		
		
	</head>
	<body>
		<div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> Leaflet Diary: Chapter 1, Plugins Galore</div>
		<div id="wrapper">

			
			<div class="navbar navbar-default" role="navigation">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a href="/"><p class="navbar-brand">Bhaskar Karambelkar&#39;s Blog</p></a>
					</div>
					<div class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
						
						<li><a href="/about/">About Me </a></li>
						
						<li><a href="/">Home </a></li>
						
						<li><a href="//photos.karambelkar.info">Photography </a></li>
						
						</ul>
					</div>
				</div>
			</div>

			
			<div id="sidebar-wrapper">
				<ul class="sidebar-nav">
					<a href="/"><img class="sidebar-logo" src="/images/profile.jpg" /></a>
					<li class="sidebar-brand"><a href="/"><h1 class="brand">Bhaskar Karambelkar&#39;s Blog</h1></a><h3></h3></li>
					<hr />
					
						<li><a href="/about/">About Me </a></li>
					
						<li><a href="/">Home </a></li>
					
						<li><a href="//photos.karambelkar.info">Photography </a></li>
					
                    <hr/>
					<div id="social-wrapper">
						<li> <a target="_blank" data-toggle="tooltip" title="LinkedIn" href="https://www.linkedin.com/in/bhaskarvk"><i class="fa fa-linkedin"></i></a></li>
						<li> <a target="_blank" data-toggle="tooltip" title="Twitter" href="https://www.twitter.com/bhaskar_vk"><i class="fa fa-twitter-square"></i></a></li>
						<li> <a target="_blank" data-toggle="tooltip" title="Github" href="https://github.com/bhaskarvk"><i class="fa fa-github-square"></i></a> </li>
                        <li> <a target="_blank" data-toggle="tooltip" title="StackOverflow" href="https://stackoverflow.com/users/507484"><i class="fa fa-stack-overflow"></i></a> </li>
                        <li> <a target="_blank" data-toggle="tooltip" title="Keybase" href="https://www.keybase.io/bhaskarvk"><i class="fa fa-key"></i></a> </li>
                        <li> <a target="_blank" data-toggle="tooltip" title="SlideShare" href="//www.slideshare.net/bhaskar_vk"><i class="fa fa-slideshare"></i></a> </li>
						<li> <a target="_blank" data-toggle="tooltip" title="RSS Feed" href="/index.xml"><i class="fa fa-rss"></i></a></li>
                    </div>
                    <hr/>
				</ul>
			</div>

			<div class="container">

<div id="article">
	<div class="article-title">Leaflet Diary: Chapter 1, Plugins Galore</div>
  <p class="meta"><small>&nbsp;<i class="fa fa-calendar-o"></i> 2016-09-19</small></p> <hr/>
  <div class="post">
		

<p>This is the second blog entry in my series &lsquo;Leaflet-Diary&rsquo;, the <a href="../leaflet-diary-prologue/">first entry</a> was nothing more than me announcing to the world that I&rsquo;m contracting with <a href="http://www.rstudio.com">RStudio</a> for adding new features to the <a href="https://rstudio.github.io/leaflet/">Leaflet</a> package.</p>

<p>This one is about what has been done so far and what&rsquo;s cooking. My plan of attack was, before adding any new features or fixing any bugs upgrade the Leaflet javascript library and existing plugins to their respective latest stable versions. The reasoning being, Leaflet javascript (henceforth LeafletJS) in the current R package is version 0.7.3. The current stable version of LeafletJS is 0.7.7. (LeafletJS 1.0 is not yet production ready.) The 0.7.7 version has seen a lot of fixes and performance improvements over 0.7.3, not to mention 0.7.3 was released way back in <a href="https://github.com/Leaflet/Leaflet/releases/tag/v0.7.3">May, 23 2014</a>. Similarly the various plugins that were bundled with the R package (see below) were also quite old and their respective current stable versions have seen similar performance and feature improvements. So it made sense to bring everything in the R package up to date. And that is exactly what I&rsquo;ve been doing for the last 2 weeks (including weekends).</p>

<p>I&rsquo;ve broken down my task in two phases, phase 1: upgrade plugins (now complete) and phase 2: upgrade LeafletJS (in progress). The reason I upgraded the plugins before LeafletJS was simply because I was more familiar with the plugin handling code than the core Leaflet code. There was a risk of some upgraded plugins not working under 0.7.3 and requiring 0.7.7, but I was willing to take that risk.</p>

<h2 id="tl-dr-version">TL;DR Version</h2>

<ul>
<li>All existing plugins have been upgraded to their respective latest versions.</li>
<li>R counterparts to any missing or new features of these plugins have also been added.</li>
<li>I&rsquo;ve introduced additional functionality in some plugins not available before.</li>
</ul>

<p>You can try out the new stuff today by building the Leaflet package from source using <code>devtools::install_github('rstudio/leaflet')</code>. For a full list of changes see the <a href="https://github.com/rstudio/leaflet/pull/293">pull request #293</a>. Also the <a href="https://github.com/rstudio/leaflet/tree/master/inst/examples">examples</a> folder has lots of new examples. You can see working sample code at my <a href="http://rpubs.com/bhaskarvk/">Rpubs</a> page.</p>

<h2 id="detailed-version">Detailed Version</h2>

<h3 id="leaflet-providers-plugin">Leaflet Providers Plugin</h3>

<p>The <a href="https://github.com/leaflet-extras/leaflet-providers">Leaflet Providers</a> plugin, which provides a convenient way to add existing free tile providers has been upgraded (See commit <a href="https://github.com/rstudio/leaflet/pull/293/commits/bcd9adf459727a88fa04a29d5c348ca4a3db8efe">bcd9adf</a> for details). Of noteworthy, was the removal of MapQuest provider (Issue <a href="https://github.com/leaflet-extras/leaflet-providers/issues/219">#219</a>) due to MapQuest closing free access. After upgrading this plugin I saw a chance to improve the R part. Instead of having to provide the provider name in the <code>addProviderTiles</code> call, I created a R list called <code>providers</code> pre-populated with Names of existing providers and base-map variants if any.</p>

<p>So now instead of</p>

<pre><code class="language-r">leaflet() %&gt;% addProviderTiles(&quot;Stamen.Toner&quot;)
</code></pre>

<p>you can do</p>

<pre><code class="language-r">leaflet() %&gt;% addProviderTiles(providers$Stamen.Toner)
</code></pre>

<p>At first this looks like more typing, but a) you can put RStudio&rsquo;s auto-complete to work for you and, b) you don&rsquo;t have to remember all the providers and their variants, and there are roughly 110 of them (I checked). For a complete example of this along with code see my <a href="http://rpubs.com/bhaskarvk/leaflet-providers">Rpubs: leaflet-providers</a> entry.</p>

<h3 id="leaflet-label-plugin">Leaflet.Label Plugin</h3>

<p>The <a href="https://github.com/Leaflet/Leaflet.label">Leaflet.Label</a> plugin allows you to add static or on-hover labels to your markers, polylines, and polygons. This plugin was upgraded to the latest version (See commits <a href="https://github.com/rstudio/leaflet/pull/293/commits/ca2f5a593d7183387eb06fa3b056b6a66ecaef02">ca2f5a5</a> &amp; <a href="https://github.com/rstudio/leaflet/pull/293/commits/8b5dd82d4b7519fce798e17d507b34a8a6561107">8bddd82</a>). In addition I also merged two pull requests on the original plugin repo and introduced some new features of my own. Now with the new version you get&hellip;</p>

<table border="0">
    <tr>
        <td>
            <image src="http://i.imgur.com/HgMzgkt.png"/>
             <br/>Label's w/o box.
        </td>
        <td>
            <image src="http://i.imgur.com/lQBFnOl.png"/>
            <br/>Customizable text size.
        </td>
        <td rowspan="2">
            <image src="http://i.imgur.com/H6yVmHv.png"/>
            <br/>Directional Labels.
        </td>
    </tr>
    <tr>
        <td>
            <image src="http://i.imgur.com/2OaHN2R.png"/>
            <br/>Stylized labels.
            
        </td>
        <td>
            <image src="http://i.imgur.com/htDjAtW.png"/>
            <br/>Markers w/o the icon.
        </td>
    </tr>
</table>

<p>I believe these new features make the plugin even more useful for your interactive mapping needs. See this <a href="http://rpubs.com/bhaskarvk/leaflet-labels">Rpubs: Leaflet-Label</a> entry for details and code samples.</p>

<h3 id="leaflet-omnivore-plugin">Leaflet-Omnivore Plugin</h3>

<p>The <a href="https://github.com/mapbox/leaflet-omnivore">Leaflet-Omnivore</a> plugin by <a href="http://www.mapbox.com">Mapbox</a> allows you to overlay GeoJSON, TopoJSON, WKT, KML, GPX files on the Leaflet map. I have upgraded this plugin to the latest version (See commit <a href="https://github.com/rstudio/leaflet/pull/293/commits/5abd3f4bfefedd476421f0f7a473537c6ec3eefd">5abd3f4</a>). I didn&rsquo;t see much changed w.r.t. the older plugin, but staying current is always a better option. For now even if the plugin is upgraded I haven&rsquo;t yet added the R API to add WKT/KML/GPX files. There is a need to support these file formats in the R package via more idiomatic R APIs. The current approach to add GeoJSON/TopoJSON is also not the most ideal one. So stay tuned for more updates on this.</p>

<p>For what it&rsquo;s worth do check out my example of handling GeoJSON using the <a href="https://github.com/ropensci/geojsonio">geojsonio</a> package over at <a href="http://rpubs.com/bhaskarvk/leaflet-geojson">Rpubs: leaflet-geojson</a>. I like this approach more than the omnivore plugin based approach because it&rsquo;s much easy to add markers/polylines/polygons and style them using data with this approach than  leaflet native approach.</p>

<h3 id="leaflet-measure-plugin">Leaflet Measure Plugin</h3>

<p>The <a href="https://github.com/ljagis/leaflet-measure">Leaflet Measure</a> is a very useful plugin that enables you to add a controller on your map which can be used to measure distances between points or areas of a polygon. I upgraded it to the latest version (See commit <a href="https://github.com/rstudio/leaflet/pull/293/commits/c58926f7a2fc8e93abdd5393a1e1feba42666932">c58926f</a>). The new version supports localization in certain locales, which goes nicely with OpenStreetMaps (OSM) base-map layer which uses localized labels.
e.g. below you see the plugin displaying the options and text in German.</p>

<p><image src="http://i.imgur.com/VD5RU42.png"/></p>

<p>For details see my <a href="http://rpubs.com/bhaskarvk/leaflet-measure">Rpubs: leaflet-measure</a> entry.</p>

<h3 id="minimap-plugin">MiniMap Plugin</h3>

<p>The <a href="https://github.com/Norkart/Leaflet-MiniMap">Minimap plugin</a> was by far the most fun and most challenging to work on. I had implemented a rudimentary example of it a while ago, but it had a fixed base-map. What I wanted was an ability to sync the mini-map&rsquo;s tile layer with the base-map&rsquo;s. And there&rsquo;s a restriction in LeafletJS in that no two map&rsquo;s can share layers. Finally I was able to achieve it albeit using some native Javascript code. And solving that problem also allowed me to solve another interesting use case of showing markers in both base-map and mini-map. See commits <a href="https://github.com/rstudio/leaflet/pull/293/commits/8eb9daaa5a9b4ea1f16f1510f6d9cefdb78f01ae">8eb9daa</a>, <a href="https://github.com/rstudio/leaflet/pull/293/commits/d5250ca3f7190457d9f6b2e67ddc9721371838cd">d5250ca</a> &amp; <a href="https://github.com/rstudio/leaflet/pull/293/commits/f392477238406a837f4a3b2c540a283a114de309">f3924772</a>
Here&rsquo;s a sample of what can be done now.<br/><br/>
<image src="http://i.imgur.com/AXUKIdk.png"/></p>

<p>For a full list of possibilities check out my <a href="http://rpubs.com/bhaskarvk/leaflet-minimap">Rpubs: Minimap</a> entry.</p>

<h3 id="simple-graticule-graticule-plugins">Simple-Graticule &amp; Graticule Plugins</h3>

<p>I had implemented the <a href="https://github.com/ablakey/Leaflet.SimpleGraticule">Simple Graticule</a> plugin, but when I did upgrade it this time, I realized that it is meant only for <a href="http://leafletjs.com/examples/crs-simple/crs-simple.html">L.CRS.Simple</a>, but there is a proper <a href="https://github.com/turban/Leaflet.Graticule">Graticule</a> plugin too, so I included it in this round too. See commit <a href="https://github.com/rstudio/leaflet/pull/293/commits/727dd479baa174d57c7072dcdac4b29017538ad1">727dd47</a> for details.</p>

<p>Check out the <a href="http://rpubs.com/bhaskarvk/leaflet-graticule">Rpubs: Graticule</a> and <a href="http://rpubs.com/bhaskarvk/leaflet-simplegraticule">Rpubs: Simple Graticule</a> entries for code samples.</p>

<h3 id="marker-clusters-plugin">Marker Clusters Plugin</h3>

<p>Finally we come to my favorite of all, the <a href="https://github.com/Leaflet/Leaflet.markercluster">Marker Cluster</a> plugin. This plugin was way overdue for an upgrade and I found two very useful sub-plugins, the <a href="https://github.com/ghybs/Leaflet.MarkerCluster.LayerSupport">layer support</a> sub-plugin &amp; the <a href="https://github.com/ghybs/Leaflet.MarkerCluster.Freezable">freezable</a> sub-plugin. The former makes marker clustering work along with layers and layer-controllers, so you can add your markers to different layers and show/hide these layers using a layer controller and the marker cluster plugin will update it&rsquo;s clusters accordingly. The later allows you to freeze/unfreeze clustering at a specific zoom level. I believe these were worth additions to what is an already very useful plugin. For the code curious see commit <a href="https://github.com/rstudio/leaflet/pull/293/commits/b6c980d5ade6729af0f4e7712397a114cb8dd30d">b6c980</a>.</p>

<p>For code samples and some spiffy clustering check out the <a href="http://rpubs.com/bhaskarvk/leaflet-marker-clusterming">Rpubs: Marker Cluster</a> entry.</p>

<h2 id="end-of-phase-1">End of Phase 1</h2>

<p>This concludes my two weeks of development. For most part the coding was grunt work and involved taking what has already been built in Javascript and making it available in R. The challenge was to make the new stuff available in as idiomatic way as possible to R. I did have to scratch my head a few times, especially with the mini-map syncing with base-map examples. In addition to these changes, I have also added two new plugins but they are not merged in the code base yet. More on them in the next post. If you like what you see or have comments/questions/critiques don&rsquo;t hesitate to contact me via <a href="https://twitter.com/bhaskar_vk">Twitter</a> or open an issue over at <a href="https://github.com/rstudio/leaflet/issues">Github</a>. In the mean time happy mapping.</p>

  </div>
</div>

<a href="https://twitter.com/share" class="twitter-share-button " data-size="small" data-count="none">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<ul class="pager">
  
   &nbsp;<li class="next"><a href="/2016/09/leaflet-diary-prologue/"> Leaflet Diary: Prologue</a></li>
</ul>

				<footer>
                    <p class="text-muted credit">&copy; 2015 Bhaskar V. Karambelkar. All rights reserved.</p>
				</footer>
			</div>
		</div>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.js"></script>
		<script type="text/javascript" src="/js/hc.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.1/js/lightbox.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/languages/r.min.js"></script>
        <script>
          hljs.initHighlightingOnLoad();
        </script>
		
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.www.karambelkar.info","*.blog.karambelkar.info"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
			var u="//apps.karambelkar.info/pk/";
			_paq.push(['setTrackerUrl', u+'piwik.php']);
			_paq.push(['setSiteId', 1]);
			var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
			g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//apps.karambelkar.info/pk/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
		
	</body>
</html>

